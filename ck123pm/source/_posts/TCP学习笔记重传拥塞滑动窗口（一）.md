title: TCP学习笔记重传拥塞（一）
author: ck123pm
date: 2020-09-24 03:13:12
tags:
---
## 重传
- 超时重传
- 快速重传
- SACK
- D-SACK

<!-- more-->
### 超时重传
`RTT`（Round-Trip Time 往返时延）

超时重传时间是以 `RTO` （Retransmission Timeout 超时重传时间）表示。

- 当超时时间 RTO 较大时，重发就慢，丢了老半天才重发，没有效率，性能差；

- 当超时时间 RTO 较小时，会导致可能并没有丢就重发，于是重发的就快，会增加网络拥塞，导致更多的超时，更多的超时导致更多的重发。

** 超时重传时间 RTO 的值应该略大于报文往返  RTT 的值 **。

### 快速重传
快速重传的工作方式是当收到`三个相同`的 ACK 报文时，会在定时器过期之前，重传丢失的报文段。

快速重传机制只解决了一个问题，就是超时时间的问题，但是它依然面临着另外一个问题。就是重传的时候，是`重传之前的一个`，还是`重传所有`的问题。

根据 TCP 不同的实现，以上两种情况都是有可能的。可见，这是一把双刃剑。

为了解决不知道该重传哪些 TCP 报文，于是就有 `SACK` 方法。

### SACK
这种方式需要在 TCP 头部「选项」字段里加一个 `SACK `的东西，它可以将缓存的地图发送给发送方，这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以只重传丢失的数据。

如果要支持 `SACK`，必须双方都要支持。在 Linux 下，可以通过 `net.ipv4.tcp_sack` 参数打开这个功能（Linux 2.4 后默认打开）。

### D-SACK
本质上也是SACK，只是用来和ACK序号搭配，可以让发送方知道是发送的数据丢了，还是接收方的ACK丢了。

![D-SACK](/images/pasted-0.png)

D-SACK 有这么几个好处：

可以让「发送方」知道，是发出去的包丢了，还是接收方回应的 ACK 包丢了;

可以知道是不是「发送方」的数据包被网络延迟了;

可以知道网络中是不是把「发送方」的数据包给复制了;

在 Linux 下可以通过 `net.ipv4.tcp_dsack` 参数开启/关闭这个功能（Linux 2.4 后默认打开）。

## 滑动窗口
通常窗口的大小是由接收方的决定
`发送方滑动窗口`
![upload successful](/images/pasted-1.png)



